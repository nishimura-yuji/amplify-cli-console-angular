version: 0.1

backend:
  phases:
    build:
      commands:
        - export STACKINFO="$(envCache --get stackInfo)"
        - amplifyPush --environment $AWS_BRANCH
        - envCache --set stackInfo "$(amplify env get --json --name $AWS_BRANCH)"

frontend:
  phases:
    preBuild:
      commands:
        - yarn install
        - export PATH=$PATH:$PWD/node_modules/.bin/
        - curl https://intoli.com/install-google-chrome.sh | bash
        - ng test --watch=false
        - ng e2e
    build:
      commands:
        - ng build --prod
  artifacts:
    baseDirectory: dist/amplify-cli-console-angular
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
